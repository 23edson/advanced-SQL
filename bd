create USER master with password 'master123';  --Cria usuários
create user comum1 with password '123';
create user comum2 with password '456';

create tablespace "t_user" OWNER  master LOCATION  '/var/lib/postgresql/9.1/main';  --Cria tablespace no local ''/var/lib/postgresql/9.1/main''
ALTER TABLE telefone SET TABLESPACE t_user;  --Altera tabela telefone para tablespace criada
CREATE SCHEMA esquema;  --cria esquema
GRANT USAGE on SCHEMA esquema to master;  --habilita uso do esquema
SET search_path to esquema;  --seta search_path
GRANT ALL privileges on 
	all tables in schema esquema to master;   --altera privilegios para os usuários

GRANT SELECT on
	all tables in schema esquema  to comum1;

GRANT SELECT,UPDATE on
	all tables in schema esquema to comum2;



alter USER master set search_path to esquema;   --Define esquema padrão para os usuários
alter USER comum1 set search_path to esquema;
alter USER comum2 set search_path to esquema;

create view car_marca( marca, qtd) as
	select nome, count(*) from fabricante natural join carro group by nome;

create view funporcli (nome_funci,cpf_func,tipo_serv,preco,horario,chassi_car,nome_cli,cpf_cli) as 
select s.nome,s.cpf,s.tipo,s.preco,s.dthorag,s.chassi,c.nome,c.cpf from 
(funcionario f natural join svfunc natural join servico natural join carro)s 
join cliente c on (s.dono=c.cpf);

create view carporcli(nome_cliente,cpf_cli,qt_caros) as 
select nome,cpf,count(chassi) from carro r join cliente c on dono=cpf 
group by nome,cpf;
